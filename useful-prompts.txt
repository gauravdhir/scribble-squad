see the mocks attached. Strictly follow the rules in .agent/rules/principal-dev.md As a reminder we don't use vitest and rely on node.js inbuilt test runner